\chapter{Fortran90の基礎１〜コンパイルと変数〜}

\section{プログラムのコンパイルと実行}
はじめに, コマンドプロンプトを立ち上げる.
%TODO コマンドプロンプトの立ち上げ方
次にソースファイルを保存するためのディレクトリを適当な場所に作成する.
%TODO ディレクトリの完成図
以下では, ホームディレクトリの下に, ``fortran"という名前のディレクトリを作成したものとして説明を進める.
ディレクトリの作成は, コマンドプロンプト上で,
\begin{Verbatim}[frame=single]
>mkdir fortran
\end{Verbatim}
と入力する. 続いて,
\begin{Verbatim}[frame=single]
>cd fortran
>notepad
\end{Verbatim}
と入力し, ディレクトリ``fortran"に移動したのち, メモ帳を開く.
%TODO 色がつくエディタを使わせたい
以上の作業はコマンドプロンプトを利用せず, マウス操作でおこなってもよい.
 
メモ帳に以下の内容を入力し, ``HelloWorld.f90"という名前で保存をする.
Fortranは大文字と小文字を区別しないため, どちらで書いても構わない.
\lstinputlisting[caption=HelloWorld.f90の中身. , label=helloworld]{source/1/HelloWorld.f90}
なお, クォーテーションマークの内側にある$_{\sqcup}$は半角スペースを意味する.
また, エクスクラメーションマーク(!)以降の緑色でハイライトされた部分はコメント文と呼ばれ,
プログラムの動作には影響を与えない文章である.
サンプルコードを真似て書くときには, コメント文を写す必要はないが,
自分でコードを書くときには, 分かりやすさのために積極的にコメント文を書くべきである.

プログラムはprogram [プログラム名]で始まり, end program [プログラム名]で終わる.
実際の命令は2行目と3行目に記述されている.
2行目のwrite文は出力, 3行目のstop文はプログラムの停止を表す.


ソースコードが書けたら, コマンドプロンプト上で次のように入力し, コンパイルする.
%TODO いつも後で実行ファイルの整理ができなくなるので、-oオプションを最初から強制しておいてはどうか
\begin{Verbatim}[frame=single]
>gfortran HelloWorld.f90
\end{Verbatim}
コンパイルとはソースコードから機械語への翻訳作業である.
正常にコンパイルが終了すれば, ディレクトリ``fortran"中に``a.exe"という実行ファイルが生成される.
\begin{Verbatim}[frame=single]
>dir
\end{Verbatim}
と入力し, 確認してみよ.

最後に生成された実行ファイルを実行する. コマンドプロンプト上で,
\begin{Verbatim}[frame=single]
>a.exe
\end{Verbatim}
と入力すれば, クォーテーションマークの内側に書いた文字列(サンプルプログラムではHello World!)が
そのまま画面上に表示される.

\section{電卓としての利用}
\subsection*{画面出力}
簡単な計算結果を画面に表示するプログラムを作成する。
\lstinputlisting[caption=電卓としての利用. , label=Calculator]{source/1/Calculator.f90}
このソースコードをコンパイルし、実行せよ。
画面に``1+1" の答えである``2" と、``3*2"の答えである``6"が表示されること確認確認せよ。
さらに3行目は、``3*2"の計算を行うのではなく、`3*2`と表示させている。この違いを確認せよ。


\subsection*{組込み関数}
Fortranには三角関数をはじめとする初等関数や変数型の変換をおこなう関数があらかじめ用意されており,
これらは組込み関数と呼ばれる.
絶対値absと平方根sqrtの使用例が以下である.
\lstinputlisting[caption={組込み関数. }, label=builtinfunction1]{source/2/BuiltinFunction1.f90}

円周率$\pi$や自然対数の底$e$は逆三角関数や指数関数を用いて次のように計算できる.
\footnote{変数を倍精度で宣言していたとしても, 関数の引数が単精度であれば戻り値も単精度になることに注意せよ.} \\
\lstinputlisting[caption={数学定数. }, label=builtinfunction2]{source/2/BuiltinFunction2.f90}
%TODO 例に変数を使わないものにする

三角関数の引数はラジアンで与えなければならない.
度からラジアンへの変換には, 以下のプログラムのようにあらかじめ計算した円周率を利用する.
\lstinputlisting[caption={三角関数. }, label=builtinfunction3]{source/2/BuiltinFunction3.f90}
%TODO 例に変数を使わないものにする

\subsection*{$<$演習課題$>$}
% この演習問題で、変数の必要性を認識させる。
対数や双曲線関数などを計算する関数が用意されている.
以下の計算結果を表示するプログラムを作成せよ。なお、一つのソースコード内に全て記述すること。
%TODO 高等関数を用いる例に変更する。さらに、繰り返し入力しなければならない内容にする。
\begin{enumerate}
%TODO 関数電卓では難しそうな例にする。
\item $\sin(1.0)$
\item $\sin(\sin(1.0))$
\item $\sqrt{\sin(\sin(1.0))}$
\end{enumerate}

\section{変数}
上記演習問題3のように、以前の計算結果を繰り返し利用したいことが多い。
そのためFortranには、計算結果を格納する{\bfseries 変数}という仕組みが用意されている。
以下は、変数を利用するプログラムである。
\lstinputlisting[caption=変数を用いた計算. , label=variable]{source/1/Calculator2.f90}


\subsection*{より汎用的な電卓プログラムの作成}
%TODO この章はとりあえずなくてもよい気がする。
画面上で二つの数値x, yを読み取り, それらをそのまま画面上に表示するプログラムの例を以下に示す.
\lstinputlisting[caption=標準入出力を用いた電卓プログラム. , label=readwrite]{source/1/ReadWrite.f90}
このプログラムを実行すると, x, yという二つの数値の入力待ちとなるため,
キーボードから任意の数字を入力する.
x=1.2, y=3.14を入力するには,
\begin{Verbatim}[frame=single]
1.2 3.14
\end{Verbatim}
のようにスペースまたは,
\begin{Verbatim}[frame=single]
1.2
3.14
\end{Verbatim}
のようにエンターで区切る.

write文とread文の括弧の中の6と5は,
それぞれ標準出力, 標準入力と呼ばれ, コマンドプロンプトの画面上での入出力を意味する. \\


次に, 画面上で二つの数値x, yを読み取り, それらの和, 差, 積, 商を計算するプログラムを以下に示す.
\lstinputlisting[caption=四則演算. , label=fouroperations]{source/1/FourOperations.f90}
和差積商はそれぞれ記号$+-*/$で表される.
\\

% TODO 出力・入力は、必要性を感じさせてから紹介する。
\begin{comment}
最後に, 二つの数値をファイルから入力するように変更したプログラムを以下に示す.
\lstinputlisting[caption=ファイル入力. , label=fileinput]{source/1/FileInput.f90}
プログラムの実行にあたっては, あらかじめ``input.dat"という入力ファイルを準備しておく必要がある.
メモ帳を用いて, ファイル``input.dat"をソースコードと同じフォルダ内に作成し, 例えば次のように入力しておくこと.
\begin{Verbatim}[frame=single]
1.2 3.14
\end{Verbatim}
\end{comment}

コンピュータは, 整数・実数・複素数を区別して扱う.
そのため, 計算結果を格納する変数がどの形式に相当するのかを予めコンピュータに伝える必要がある。
前述ソースコード中の{\ttfamily integer x} は、変数{\ttfamily x}が整数型(integer)であることを示す。
Fortranにおいて整数・実数・複素数は, それぞれ整数型(integer), 実数型(real(8)), 複素数型(complex)と呼ばれる形式で扱われる.

数学的には、整数・実数も全て複素数に含まれるが、コンピュータに数値計算をさせる時には、それらを区別し取り扱うことで効率の良い計算ができる。
例えば, 1, 2, 3, $\cdots$と離散的に数え上げられるものには整数型を用いるべきであるし,
計算結果が明らかに実数である計算において複素数型を用いることは、不必要な虚数部を計算することになるため計算機資源の無駄となる
\footnote{実数型には単精度実数型(real)と倍精度実数型(real(8))が存在し
(実は4倍精度実数型というものもあるがここでは触れない),
それぞれ十進数で約7桁, 16桁の精度をもつ.
特別の理由がない限り, 実数型の計算においては倍精度実数型を用いるのが普通である.
}.
型の違いが計算結果にどのように影響するか, 次のプログラムを実行することで確かめてみよ.
\footnote{
  プログラム中の3行目から6行目が変数型を宣言している部分である.
  もしも変数型を明示的に宣言しないと, a-h, o-zで始まる変数は``単精度"実数型,
  i-nで始まる変数は整数型として自動的に扱われる(暗黙の型宣言).
}
\footnote{
  プログラムの冒頭に記した``implicit none"は暗黙の型宣言を禁止する命令であり,
  宣言をしていない変数を使用するとコンパイルエラーになる.
  暗黙の型宣言を禁止することで, タイプミスや変数型の勘違いなどを防ぐことができるので,
  バグの入りにくいプログラムを書くことができる.
}
\lstinputlisting[caption={整数型, 実数型, 複素数型. }, label=variabletype]{source/2/VariableType.f90}

変数に数値を代入するには記号$=$を使う.
これは等号ではなく, 左辺の変数に右辺の値を代入する命令であることに注意せよ.

値の書き方は用いる変数型によって異なる.
例えば10という値は, 整数型ではそのまま10と書けばよいが,
倍精度実数型では10.d0または1.d1, 倍精度複素数型では(10.d0, 0.d0)となどと書く. \\

\begin{comment}
Fortranは文字も変数として扱うことができる(文字型: character).
文字の長さはcharacter(len=5)などとして指定する.
次のプログラムは文字型を扱った例である.
\lstinputlisting[caption={文字型. }, label=variabletype2]{source/2/VariableType2.f90}
\end{comment}


\subsection*{$<$演習課題$>$}
二辺の長さとそれらのなす角度を読み取り, その三角形の面積を計算するプログラムを作成せよ. \\

\begin{comment}
異なる型同士の演算は文法エラーではないが,
避けることが望ましい.
以下のプログラムは, 整数型, 実数型, 複素数型間の型変換の例である.
\lstinputlisting[caption={型変換. }, label=builtinfunction4]{source/2/BuiltinFunction4.f90}
\end{comment}
